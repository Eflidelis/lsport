/* базовые переменные под тёмную/светлую темы */
:root {
  --glow-sens: 30;           /* чувствительность подсветки */
  --glow-boost: 0%;
  --glow-h: 260;             /* базовый тон */
  --glow-color: var(--glow-h) 80% 80%;
  --blend: soft-light;
  --glow-blend: plus-lighter;
}

/* Светлая тема (если понадобится) */
body.light .glow-card {
  --blend: darken;
  --glow-blend: luminosity;
  --glow-h: 280;
  --glow-color: var(--glow-h) 90% 95%;
  --glow-boost: 15%;
}

/* Обёртка */
.glow-card {
  position: relative;
  border-radius: var(--radius, 18px);
  isolation: isolate;
  transform: translate3d(0,0,0.01px);
  border: 1px solid rgb(255 255 255 / 25%); /* тонкая кайма */
  background: var(--card-bg, transparent);
  background-repeat: no-repeat;

  /* плавное исчезновение, когда курсор далеко */
  &::before,
  &::after,
  > .glow {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: inherit;
    transition: opacity .25s ease-out;
    z-index: -1;
  }

  &:not(:hover):not(.glow-animating) {
    &::before,
    &::after,
    > .glow {
      opacity: 0;
      transition: opacity .6s ease-in-out;
    }
  }

  /* сетка «мэш»-градиентов по краям (тонкая цветная кайма) */
  &::before {
    border: 1px solid transparent;
    background:
      linear-gradient(var(--card-bg, transparent) 0 100%) padding-box,
      linear-gradient(rgb(255 255 255 / 0%) 0% 100%) border-box,
      radial-gradient(at 80% 55%, hsla(268,100%,76%,1) 0px, transparent 50%) border-box,
      radial-gradient(at 69% 34%, hsla(349,100%,74%,1) 0px, transparent 50%) border-box,
      radial-gradient(at 8% 6%,  hsla(136,100%,78%,1) 0px, transparent 50%) border-box,
      radial-gradient(at 41% 38%, hsla(192,100%,64%,1) 0px, transparent 50%) border-box,
      radial-gradient(at 86% 85%, hsla(186,100%,74%,1) 0px, transparent 50%) border-box,
      radial-gradient(at 82% 18%, hsla(52,100%,65%,1) 0px, transparent 50%) border-box,
      radial-gradient(at 51% 4%,  hsla(12,100%,72%,1) 0px, transparent 50%) border-box,
      linear-gradient(#c299ff 0 100%) border-box;

    /* ярче у ближайшего края и сектор в сторону курсора */
    opacity: calc((var(--pointer-d, 0) - 40) / 60);
    mask-image:
      conic-gradient(from var(--pointer-°, 0deg) at center,
        black 25%, transparent 40%, transparent 60%, black 75%
      );
  }

  /* мягкий «цветной объём» внутри, завязанный на направление курсора */
  &::after {
    border: 1px solid transparent;
    background:
      radial-gradient(at 80% 55%, hsla(268,100%,76%,.8) 0px, transparent 50%) padding-box,
      radial-gradient(at 69% 34%, hsla(349,100%,74%,.7) 0px, transparent 50%) padding-box,
      radial-gradient(at 8% 6%,  hsla(136,100%,78%,.7) 0px, transparent 50%) padding-box,
      radial-gradient(at 41% 38%, hsla(192,100%,64%,.7) 0px, transparent 50%) padding-box,
      radial-gradient(at 86% 85%, hsla(186,100%,74%,.7) 0px, transparent 50%) padding-box,
      radial-gradient(at 82% 18%, hsla(52,100%,65%,.7) 0px, transparent 50%) padding-box,
      radial-gradient(at 51% 4%,  hsla(12,100%,72%,.7) 0px, transparent 50%) padding-box,
      linear-gradient(#c299ff 0 100%) padding-box;

    mask-image:
      linear-gradient( to bottom, black, black ),
      radial-gradient( ellipse at 50% 50%, black 40%, transparent 65% ),
      radial-gradient( ellipse at 66% 66%, black 5%, transparent 40% ),
      radial-gradient( ellipse at 33% 33%, black 5%, transparent 40% ),
      radial-gradient( ellipse at 66% 33%, black 5%, transparent 40% ),
      radial-gradient( ellipse at 33% 66%, black 5%, transparent 40% ),
      conic-gradient( from var(--pointer-°, 0deg) at center,
                      transparent 5%, black 15%, black 85%, transparent 95% );

    mask-composite: subtract, add, add, add, add, add;
    opacity: calc((var(--pointer-d, 0) - 50) / 50);
    mix-blend-mode: var(--blend);
  }

  /* яркое «свечение» по кромке (поверх) */
  > .glow {
    --outset: 28px;            /* запас вокруг, чтобы свечение свободно выходило за рамки */
    inset: calc(var(--outset) * -1);
    pointer-events: none;
    z-index: 1;
    mask-image:
      conic-gradient(from var(--pointer-°, 0deg) at center,
        black 2.5%, transparent 10%, transparent 90%, black 97.5%
      );
    opacity: calc((var(--pointer-d, 0) - var(--glow-sens)) / (100 - var(--glow-sens)));
    mix-blend-mode: var(--glow-blend);

    &::before {
      content: '';
      position: absolute;
      inset: var(--outset);
      border-radius: inherit;
      /* стек из теней для «неонового» края */
      box-shadow:
        inset 0 0 0 1px hsl(var(--glow-color) / 100%),
        inset 0 0 3px 0 hsl(var(--glow-color) / calc(var(--glow-boost) + 60%)),
        inset 0 0 6px 0 hsl(var(--glow-color) / calc(var(--glow-boost) + 40%)),
        inset 0 0 15px 0 hsl(var(--glow-color) / calc(var(--glow-boost) + 30%)),
        inset 0 0 25px 2px hsl(var(--glow-color) / calc(var(--glow-boost) + 20%)),
        0 0 6px 0 hsl(var(--glow-color) / calc(var(--glow-boost) + 40%)),
        0 0 15px 0 hsl(var(--glow-color) / calc(var(--glow-boost) + 30%)),
        0 0 25px 2px hsl(var(--glow-color) / calc(var(--glow-boost) + 20%));
    }
  }

  /* внутренний контейнер для контента */
  .glow-inner {
    position: relative;
    border-radius: inherit;
    background: var(--inner-bg, transparent);
  }
}

/* Небольшой «объём» для белых блоков на светлом фоне */
.glow-card.is-pastel {
  --inner-bg: color-mix(in hsl, hsl(260, 25%, 96%), white 20%);
  --card-bg: linear-gradient(8deg, color-mix(in hsl, hsl(260, 25%, 95%), black 2.5%) 75%, hsl(260, 25%, 96%) 75.5%);
  border-color: rgb(0 0 0 / 10%);
}
